# Butler 独立单片机 (Standalone) 接入指南

本指南介绍如何将单片机（如 ESP32）设计为一个 **独立的人工智能终端**。该模式下，单片机不依赖电脑运行的 Butler，而是直接通过 WiFi 访问云端 LLM API（如 DeepSeek）。

## 1. 方案特点

*   **完全独立**：只需给单片机供电并连接 WiFi，即可进行 AI 对话。
*   **低成本**：无需运行昂贵的 PC 服务器，只需一颗 ESP32 芯片。
*   **硬件联动**：AI 可以直接控制单片机上的 GPIO 引脚（灯光、电机、传感器）。

## 2. 硬件要求

*   **核心板**：强烈建议使用 **ESP32-S3**。它拥有更强的算力、更多的内存（PSRAM）以及更好的 HTTPS 处理能力。
*   **显示/交互**：可以使用串口监视器，也可以自行扩展 OLED 屏幕或触摸屏。

## 3. 开发环境搭建

1.  **安装 Arduino IDE**。
2.  **安装 ESP32 开发板支持**。
3.  **安装依赖库**：在“库管理器”中搜索并安装 `ArduinoJson`。

## 4. 固件部署

1.  进入项目目录：`embedded/esp32_standalone/`。
2.  使用 Arduino IDE 打开 `AI_Terminal.ino`。
3.  **修改配置**：
    *   `ssid`: 你的 WiFi 名称。
    *   `password`: 你的 WiFi 密码。
    *   `apiKey`: 你的 DeepSeek API Key。
4.  **编译并烧录**：点击“上传”按钮。

## 5. 指令触发原理

为了让 AI 能够控制硬件，我们在“系统提示词”中预定义了特殊标签。

*   **系统提示词**：告诉 AI，如果需要开灯，请在回复末尾添加 `[LED_ON]`。
*   **解析逻辑**：单片机在收到回复后，会搜索这些字符串：
    ```cpp
    if (aiResponse.indexOf("[LED_ON]") != -1) {
        digitalWrite(LED_PIN, HIGH);
    }
    ```

你可以根据需要自行添加更多标签，例如 `[PLAY_MUSIC]`, `[GET_TEMP]` 等。

## 6. 进阶：如何增加新功能？

如果你想让 AI 能读取单片机上的传感器数据：
1.  **读取传感器**：在 `loop()` 中获取温度值。
2.  **动态 Prompt**：将温度值拼接在用户的提问中，发给 AI。
3.  **AI 决策**：AI 根据温度值决定是否返回 `[FAN_ON]` 标签。

这种方式让你的单片机拥有了“大脑”，能够根据环境变化做出智能反应。
